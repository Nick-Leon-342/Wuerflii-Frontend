{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/nickl/Desktop/Git Projects/kniffel/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/nickl/Desktop/Git Projects/kniffel/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{axiosPrivate}from\"../api/axios\";import{useEffect}from\"react\";import useRefreshToken from\"./useRefreshToken\";import useAuth from\"./useAuth\";var useAxiosPrivate=function useAxiosPrivate(){var refresh=useRefreshToken();var _useAuth=useAuth(),auth=_useAuth.auth;useEffect(function(){var requestIntercept=axiosPrivate.interceptors.request.use(function(config){if(!config.headers['Authorization']){config.headers['Authorization']=\"Bearer \".concat(auth===null||auth===void 0?void 0:auth.accessToken);}return config;},function(error){return Promise.reject(error);});var responseIntercept=axiosPrivate.interceptors.response.use(function(response){return response;},/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(error){var _error$response;var prevRequest,newAccessToken;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:prevRequest=error===null||error===void 0?void 0:error.config;if(!((error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===403&&!(prevRequest!==null&&prevRequest!==void 0&&prevRequest.sent))){_context.next=8;break;}prevRequest.sent=true;_context.next=5;return refresh();case 5:newAccessToken=_context.sent;prevRequest.headers['Authorization']=\"Bearer \".concat(newAccessToken);return _context.abrupt(\"return\",axiosPrivate(prevRequest));case 8:return _context.abrupt(\"return\",Promise.reject(error));case 9:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());return function(){axiosPrivate.interceptors.request.eject(requestIntercept);axiosPrivate.interceptors.response.eject(responseIntercept);};},[auth,refresh]);return axiosPrivate;};export default useAxiosPrivate;","map":{"version":3,"names":["axiosPrivate","useEffect","useRefreshToken","useAuth","useAxiosPrivate","refresh","_useAuth","auth","requestIntercept","interceptors","request","use","config","headers","concat","accessToken","error","Promise","reject","responseIntercept","response","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_error$response","prevRequest","newAccessToken","wrap","_callee$","_context","prev","next","status","sent","abrupt","stop","_x","apply","arguments","eject"],"sources":["C:/Users/nickl/Desktop/Git Projects/kniffel/src/hooks/useAxiosPrivate.js"],"sourcesContent":["\r\n\r\nimport { axiosPrivate } from \"../api/axios\"\r\nimport { useEffect } from \"react\"\r\nimport useRefreshToken from \"./useRefreshToken\"\r\nimport useAuth from \"./useAuth\"\r\n\r\nconst useAxiosPrivate = () => {\r\n    const refresh = useRefreshToken()\r\n    const { auth } = useAuth()\r\n\r\n    useEffect(() => {\r\n\r\n        const requestIntercept = axiosPrivate.interceptors.request.use(\r\n            config => {\r\n                if (!config.headers['Authorization']) {\r\n                    config.headers['Authorization'] = `Bearer ${auth?.accessToken}`\r\n                }\r\n                return config\r\n            }, (error) => Promise.reject(error)\r\n        );\r\n\r\n        const responseIntercept = axiosPrivate.interceptors.response.use(\r\n            response => response,\r\n            async (error) => {\r\n                const prevRequest = error?.config\r\n                if (error?.response?.status === 403 && !prevRequest?.sent) {\r\n                    prevRequest.sent = true\r\n                    const newAccessToken = await refresh()\r\n                    prevRequest.headers['Authorization'] = `Bearer ${newAccessToken}`\r\n                    return axiosPrivate(prevRequest)\r\n                }\r\n                return Promise.reject(error)\r\n            }\r\n        );\r\n\r\n        return () => {\r\n            axiosPrivate.interceptors.request.eject(requestIntercept)\r\n            axiosPrivate.interceptors.response.eject(responseIntercept)\r\n        }\r\n    }, [auth, refresh])\r\n\r\n    return axiosPrivate\r\n}\r\n\r\nexport default useAxiosPrivate"],"mappings":"kRAEA,OAASA,YAAY,KAAQ,cAAc,CAC3C,OAASC,SAAS,KAAQ,OAAO,CACjC,MAAO,CAAAC,eAAe,KAAM,mBAAmB,CAC/C,MAAO,CAAAC,OAAO,KAAM,WAAW,CAE/B,GAAM,CAAAC,eAAe,CAAG,QAAlB,CAAAA,eAAeA,CAAA,CAAS,CAC1B,GAAM,CAAAC,OAAO,CAAGH,eAAe,CAAC,CAAC,CACjC,IAAAI,QAAA,CAAiBH,OAAO,CAAC,CAAC,CAAlBI,IAAI,CAAAD,QAAA,CAAJC,IAAI,CAEZN,SAAS,CAAC,UAAM,CAEZ,GAAM,CAAAO,gBAAgB,CAAGR,YAAY,CAACS,YAAY,CAACC,OAAO,CAACC,GAAG,CAC1D,SAAAC,MAAM,CAAI,CACN,GAAI,CAACA,MAAM,CAACC,OAAO,CAAC,eAAe,CAAC,CAAE,CAClCD,MAAM,CAACC,OAAO,CAAC,eAAe,CAAC,WAAAC,MAAA,CAAaP,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEQ,WAAW,CAAE,CACnE,CACA,MAAO,CAAAH,MAAM,CACjB,CAAC,CAAE,SAACI,KAAK,QAAK,CAAAC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC,EACvC,CAAC,CAED,GAAM,CAAAG,iBAAiB,CAAGnB,YAAY,CAACS,YAAY,CAACW,QAAQ,CAACT,GAAG,CAC5D,SAAAS,QAAQ,QAAI,CAAAA,QAAQ,+BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CACpB,SAAAC,QAAOT,KAAK,MAAAU,eAAA,KAAAC,WAAA,CAAAC,cAAA,QAAAL,mBAAA,GAAAM,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SACFN,WAAW,CAAGX,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAEJ,MAAM,MAC7B,CAAAI,KAAK,SAALA,KAAK,kBAAAU,eAAA,CAALV,KAAK,CAAEI,QAAQ,UAAAM,eAAA,iBAAfA,eAAA,CAAiBQ,MAAM,IAAK,GAAG,EAAI,EAACP,WAAW,SAAXA,WAAW,WAAXA,WAAW,CAAEQ,IAAI,IAAAJ,QAAA,CAAAE,IAAA,UACrDN,WAAW,CAACQ,IAAI,CAAG,IAAI,CAAAJ,QAAA,CAAAE,IAAA,SACM,CAAA5B,OAAO,CAAC,CAAC,QAAhCuB,cAAc,CAAAG,QAAA,CAAAI,IAAA,CACpBR,WAAW,CAACd,OAAO,CAAC,eAAe,CAAC,WAAAC,MAAA,CAAac,cAAc,CAAE,QAAAG,QAAA,CAAAK,MAAA,UAC1DpC,YAAY,CAAC2B,WAAW,CAAC,gBAAAI,QAAA,CAAAK,MAAA,UAE7BnB,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC,0BAAAe,QAAA,CAAAM,IAAA,MAAAZ,OAAA,GAC/B,mBAAAa,EAAA,SAAAjB,IAAA,CAAAkB,KAAA,MAAAC,SAAA,OACL,CAAC,CAED,MAAO,WAAM,CACTxC,YAAY,CAACS,YAAY,CAACC,OAAO,CAAC+B,KAAK,CAACjC,gBAAgB,CAAC,CACzDR,YAAY,CAACS,YAAY,CAACW,QAAQ,CAACqB,KAAK,CAACtB,iBAAiB,CAAC,CAC/D,CAAC,CACL,CAAC,CAAE,CAACZ,IAAI,CAAEF,OAAO,CAAC,CAAC,CAEnB,MAAO,CAAAL,YAAY,CACvB,CAAC,CAED,cAAe,CAAAI,eAAe"},"metadata":{},"sourceType":"module","externalDependencies":[]}